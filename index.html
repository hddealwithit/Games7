<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bard's Legacy</title>
    <style>
        :root { --primary: #2c3e50; --accent: #00ffcc; --glitch-bg: #0a0a0a; }
        body { font-family: 'Georgia', serif; line-height: 1.6; margin: 0; background-color: #f4f1ea; color: #333; transition: background 0.5s; }
        
        /* Navigation */
        nav { background: var(--primary); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        #mainSearch { padding: 8px; border-radius: 4px; border: none; width: 220px; outline: none; }
        #aboutLink { cursor: pointer; font-weight: bold; text-decoration: none; color: white; }

        /* Article Container */
        article { max-width: 800px; margin: 40px auto; padding: 30px; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 8px; transition: 0.3s; }
        h1 { color: #5d4037; font-size: 2.5rem; border-bottom: 1px solid #ddd; padding-bottom: 10px; }

        /* Glitch State */
        body.glitched { background-color: var(--glitch-bg); color: #444; }
        body.glitched article { background: #0f0f0f; color: #555; border: 1px solid #1a1a1a; box-shadow: none; }
        body.glitched h1 { color: #880000; border-bottom: 1px solid #222; }
        .glitch-text { font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.2; margin-top: 20px; }

        /* Secret Portal Square */
        #purpleSquare { 
            display: none; width: 8px; height: 8px; background: #800080; 
            margin: 60px auto 20px auto; cursor: crosshair; opacity: 0.6;
        }

        /* Gaming Hub Overlay */
        #gamingHub {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050505; color: var(--accent); z-index: 1000; padding: 40px; box-sizing: border-box;
            text-align: center; overflow-y: auto; font-family: 'Courier New', Courier, monospace;
        }
        #hubSearch { padding: 15px; width: 450px; background: #111; border: 1px solid var(--accent); color: var(--accent); margin-bottom: 35px; outline: none; font-size: 1.1rem; }
        .game-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; max-width: 1400px; margin: 0 auto; padding-bottom: 50px; }
        .game-item { font-size: 0.95rem; cursor: pointer; padding: 15px; border: 1px solid rgba(0, 255, 204, 0.2); background: rgba(255, 255, 255, 0.02); text-transform: uppercase; transition: 0.2s; }
        .game-item:hover { border: 1px solid var(--accent); background: rgba(0, 255, 204, 0.1); color: #fff; }
        .hidden { display: none !important; }

        /* Same-Site Game Player Box */
        #gamePlayer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 3000; }
        #gameIframe { width: 100%; height: 100%; border: none; }
        .back-btn { position: absolute; top: 15px; left: 15px; z-index: 3001; background: #111; color: var(--accent); border: 1px solid var(--accent); padding: 8px 15px; cursor: pointer; font-family: monospace; }
    </style>
</head>
<body onmousemove="resetTimer()" onkeydown="resetTimer()">

<nav>
    <input type="text" id="mainSearch" placeholder="Search literary archive...">
    <a id="aboutLink">About Us</a>
</nav>

<article id="contentBody">
    <h1 id="titleText">William Shakespeare</h1>
    <div id="articleText">
        <p>William Shakespeare (1564–1616) was an English playwright, poet, and actor. He is widely regarded as the greatest writer in the English language and the world's pre-eminent dramatist.</p>
        <p>His works consist of some 39 plays, 154 sonnets, and three long narrative poems. His plays have been translated into every major living language and are performed more often than those of any other playwright.</p>
    </div>
    <div id="purpleSquare" onclick="openHub()"></div>
</article>

<div id="gamePlayer">
    <button class="back-btn" onclick="closeGame()">← EXIT TO HUB</button>
    <iframe id="gameIframe" src=""></iframe>
</div>

<div id="gamingHub">
    <h1 style="letter-spacing: 12px; color: #cc0000; margin-bottom: 5px;">SYSTEM_OVERRIDE</h1>
    <p style="font-size: 0.8rem; opacity: 0.5; margin-bottom: 30px;">[ AUTO-STEALTH ACTIVE: 120s ]</p>
    
    <input type="text" id="hubSearch" placeholder="SEARCH ENCRYPTED FILES..." onkeyup="filterGames()">
    
    <div class="game-list" id="fullGameList">
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/tomb-of-the-mask/')">Tomb of Mask</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/drive-mad/')">Drive Mad</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/drift-hunters/')">Drift Hunters</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/1v1-lol/')">1v1.LOL</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/retro-bowl/')">Retro Bowl</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/monkey-mart/')">Monkey Mart</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/bitlife/')">BitLife</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/slope/')">Slope</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/eggy-car/')">Eggy Car</div>
        <div class="game-item" onclick="launch('https://tomb-of-the-mask.bitbucket.io/geometry-dash/')">Geo Dash</div>

        <div class="game-item" onclick="launch('cl1.html')">2048</div>
        <div class="game-item" onclick="launch('cl10bullets.html')">10 Bullets</div>
        <div class="game-item" onclick="launch('cl10minutestildawn.html')">10 Mins Till Dawn</div>
        <div class="game-item" onclick="launch('cl1on1soccer.html')">1 on 1 Soccer</div>
        <div class="game-item" onclick="launch('cl1v1lol.html')">1v1.lol (Local)</div>
        <div class="game-item" onclick="launch('cl1v1tennis.html')">1v1 Tennis</div>
        <div class="game-item" onclick="launch('cl2doom.html')">2DOOM</div>
        <div class="game-item" onclick="launch('cl2Dshooting.html')">2D Shooting</div>
        <div class="game-item" onclick="launch('cl3dash.html')">3Dash</div>
        <div class="game-item" onclick="launch('cl3dasheditor.html')">3Dash Editor</div>
        <div class="game-item" onclick="launch('cl3dpinballspacecadet.html')">3D Pinball</div>
        <div class="game-item" onclick="launch('cl3pandas.html')">3 Pandas (Original)</div>
        <div class="game-item" onclick="launch('cl3pandasbrazil.html')">3 Pandas: Brazil</div>
        <div class="game-item" onclick="launch('cl3pandasfantasy.html')">3 Pandas: Fantasy</div>
        <div class="game-item" onclick="launch('cl3pandasjapan.html')">3 Pandas: Japan</div>
        <div class="game-item" onclick="launch('cl3pandasnight.html')">3 Pandas: Night</div>
        <div class="game-item" onclick="launch('cl3slices2.html')">3 Slices 2</div>
        <div class="game-item" onclick="launch('cl4thandgoal.html')">4th and Goal</div>
        <div class="game-item" onclick="launch('cl8ballclassic.html')">8 Ball Classic</div>
        <div class="game-item" onclick="launch('cl8ballpool.html')">8 Ball Pool</div>
        <div class="game-item" onclick="launch('astra.html')">Astraclient</div>
        <div class="game-item" onclick="launch('Hollow Knight.html')">Hollow Knight</div>
        <div class="game-item" onclick="launch('claquaparkio.html')">Aquapark.io</div>
        <div class="game-item" onclick="launch('JimmyQRG.html')">JimmyQRG</div>
        <div class="game-item" onclick="launch('https://jimmyqrg.github.io/loader/?content=https%3A%2F%2Fjimmyqrg.github.io%2Fjqrg-games%2Fgames%2Fpaperio2.html')">Paper.io 2</div>
        <div class="game-item" onclick="launch('https://jimmyqrg.github.io/loader/?content=https%3A%2F%2Fjimmyqrg.github.io%2Fjqrg-games%2Fgames%2Fsolar-smash.html')">Solar Smash</div>
        <div class="game-item" onclick="launch('https://jimmyqrg.github.io/loader/?content=https%3A%2F%2Fjimmyqrg.github.io%2Fjqrg-games%2Feaglercraft%2Fhacks%2F')">Eaglercraft Hacks</div>
        <div class="game-item" onclick="launch('https://jimmyqrg.github.io/loader/?content=https%3A%2F%2Fjimmyqrg.github.io%2Fjqrg-games%2Fgames%2Fdeltarune.html')">Deltarune</div>
        <div class="game-item" onclick="launch('https://jimmyqrg.github.io/loader/?content=https%3A%2F%2Fjimmyqrg.github.io%2Fjqrg-games%2Fgames%2Fundertale.html')">Undertale</div>
    </div>
</div>

<script>
    // ==========================================
    // ALLOWED IP WHITELIST - UPDATED
    // ==========================================
    const ALLOWED_IPS = ['149.19.46.18']; 
    // ==========================================

    let user_ip = "";
    let access_granted = false;
    let idleTime = 0;

    const mainSearch = document.getElementById('mainSearch');
    const purpleSquare = document.getElementById('purpleSquare');
    const gamingHub = document.getElementById('gamingHub');
    const gamePlayer = document.getElementById('gamePlayer');
    const gameIframe = document.getElementById('gameIframe');

    // Fetch IP and Check Permission
    async function checkPermission() {
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            user_ip = data.ip;
            if (ALLOWED_IPS.includes(user_ip)) {
                access_granted = true;
            }
        } catch (e) {
            console.log("Network status: check failed.");
        }
    }
    checkPermission();

    // 1. Entrance Logic
    document.getElementById('aboutLink').addEventListener('click', () => {
        if (access_granted && mainSearch.value === 'abhoy') {
            triggerGlitch();
        } else {
            alert("Education Resource: Indexing Shakespeare 1.0.4...");
        }
    });

    function triggerGlitch() {
        document.body.classList.add('glitched');
        document.getElementById('titleText').innerText = "FATAL_ERROR: BUFFER_OVERFLOW";
        let glitchContent = "";
        for(let i=0; i<60; i++) {
            glitchContent += `<p class="glitch-text">0x${Math.random().toString(16).slice(2,10).toUpperCase()} - ACCESS_DENIED - KERNEL_PANIC - ${i === 30 ? "<b>STAY CALM.</b>" : "RETRY_CONNECT"}</p>`;
        }
        document.getElementById('articleText').innerHTML = glitchContent;
        mainSearch.value = ""; 
    }

    // 2. Secret Phrase Listener
    mainSearch.addEventListener('input', () => {
        if (document.body.classList.contains('glitched')) {
            if (mainSearch.value.toLowerCase() === "i don't like this") {
                purpleSquare.style.display = "block";
                purpleSquare.scrollIntoView({ behavior: 'smooth' });
            } else {
                purpleSquare.style.display = "none";
            }
        }
    });

    mainSearch.addEventListener('keypress', (e) => {
        if (e.key === "Enter") {
            window.location.reload(); 
        }
    });

    // 3. Hub & Game Functions
    function openHub() {
        gamingHub.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    function launch(url) {
        gameIframe.src = url;
        gamePlayer.style.display = 'block';
    }

    function closeGame() {
        gamePlayer.style.display = 'none';
        gameIframe.src = '';
    }

    // 4. Panic & Stealth Logic
    function panic() {
        window.location.replace("https://www.google.com");
    }

    function resetTimer() { idleTime = 0; }

    setInterval(() => {
        idleTime++;
        if (idleTime >= 120) { 
            if (gamingHub.style.display === 'block' || document.body.classList.contains('glitched')) {
                panic();
            }
        }
    }, 1000);

    window.addEventListener('keydown', (e) => {
        if (e.key === "Tab") {
            e.preventDefault();
            panic();
        }
    });

    function filterGames() {
        const query = document.getElementById('hubSearch').value.toLowerCase();
        document.querySelectorAll('.game-item').forEach(item => {
            item.classList.toggle('hidden', !item.textContent.toLowerCase().includes(query));
        });
    }
</script>
</body>
</html>
